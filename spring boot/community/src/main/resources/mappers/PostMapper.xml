<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.hi.community.dao.PostDAO"> <!-- 패키지명.인터페이스파일명 -->

	<!-- id에는 dao의 메서드명을 입력. 오타 발생시 예외 발생
	~~~(not found) 예외 발생 -->
	<select id="selectPostList" resultType="PostVO">
		select post.*, bo_name po_bo_name from post <!-- bo_name을 po_bo_name으로 하겠다 -->
		join board on po_bo_num = bo_num
		<!--  삭제 안된 게시글을 조회 -->
		where po_del = 'N'
		<!-- 전체 게시판이 아닌 경우 -->
		<if test="cri.boardNum != 0"> <!-- cri.boardNum이 0(전체게시판)이 아니면 아래 번호 -->
			and po_bo_num = ${cri.boardNum}
		</if>
		<!-- 제목 또는 내용이 포함되는 경우 -->
		<if test="cri.type != 2">
			and (
			<!-- '%검색어%'로 만들기 위해 concat을 활용 -->
			po_title like concat('%', #{cri.search}, '%')
			or po_content like concat('%', #{cri.search}, '%')
			
			)
		</if>
		<!-- 작성자로 검색하는 경우 -->
		<if test="cri.type == 2">
			and po_me_id = #{cri.search}
		</if>
		<!-- 제목 또는 내용 또는 작성자로 검색하는 경우 -->
		<if test="cri.type == 0">
			and (
			<!-- '%검색어%'로 만들기 위해 concat을 활용 -->
			po_title like concat('%', #{cri.search}, '%')
			or po_content like concat('%', #{cri.search}, '%')
			or po_me_id = #{cri.search}
			)
		</if>
		
		<!-- 최신 게시글이 위에 가도록 정렬 -->
		order by po_num desc
		<!-- 페이지에 맞게 잘라서 가져옴 -->
		<!-- cri.pageStart를 하면 실제는 cri.getPageStart()를 호출 -->
		limit #{cri.pageStart}, #{cri.perPageNum}
	</select>
	
	<update id="updateView">
		update post
		set
			<!-- 조회수 증가 -->
			po_view = po_view + 1
		where
			po_num = #{num}
			<!-- 삭제가 안된 게시글 -->
			and po_del = 'N'
	</update>
	
	<select id="selectPost" resultType="PostVO"> <!-- id: DAO 메서드명 / resultType : vo의 파일 명  -->
		select * from post 
		where po_num = #{num}	<!-- dao에서 num으로 쓰기로 했기 때문에 num -->
		<!-- 삭제가 안된 게시글을 가져옴 -->
		and po_del = 'N' 

	</select>
	
	<select id="selectBoardList" resultType="BoardVO">
		select * from board 
	</select>	

	<insert id="insertPost">
		insert into post(po_title, po_content, po_me_id, po_bo_num)
   		values(#{post.title}, #{post.content}, #{post.writer}, #{post.board}) <!-- 왜 post? DAO에서 post로 이름 지정했으니까 -->
	</insert>
	
	<insert id="insertBoard">
		insert into board(bo_name) values(#{name})
		
	</insert>
	
	<delete id="deleteBoard">
		delete from board where bo_num = #{num}
	</delete>
	
	<update id="updateBoard">
		update board
   		set
   			bo_name = #{name}
   		where
   			bo_num = #{num}
	</update>
	
	<select id="selectTotalCount" resultType="int">
	select count(*) from post <!-- selectPostList 부분 가져와서 앞에 2줄 수정(join 삭제 등) / 하단 정렬 및 limit도 삭제 -->
		<!--  삭제 안된 게시글을 조회 -->
		where po_del = 'N'
		<!-- 전체 게시판이 아닌 경우 -->
		<if test="cri.boardNum != 0"> <!-- cri.boardNum이 0(전체게시판)이 아니면 아래 번호 -->
			and po_bo_num = ${cri.boardNum}
		</if>
		<!-- 제목 또는 내용이 포함되는 경우 -->
		<if test="cri.type != 2">
			and (
			<!-- '%검색어%'로 만들기 위해 concat을 활용 -->
			po_title like concat('%', #{cri.search}, '%')
			or po_content like concat('%', #{cri.search}, '%')
			
			)
		</if>
		<!-- 작성자로 검색하는 경우 -->
		<if test="cri.type == 2">
			and po_me_id = #{cri.search}
		</if>
		<!-- 제목 또는 내용 또는 작성자로 검색하는 경우 -->
		<if test="cri.type == 0">
			and (
			<!-- '%검색어%'로 만들기 위해 concat을 활용 -->
			po_title like concat('%', #{cri.search}, '%')
			or po_content like concat('%', #{cri.search}, '%')
			or po_me_id = #{cri.search}
			)
		</if>
	</select>
	<update id="deletePost">
		update post 
			<!-- po_del을 Y로 하면서 화면에서는 삭제된것 처럼 보이나 실제로는 숨김처리 한것 뿐 워크벤치 가면 남아있는거 확인됨 -->
			set po_del = 'Y'
			where po_num = #{num}
	</update>
</mapper>